<!DOCTYPE html>
<html>
<head>
  <title>RTK-AFrame Bridge Example</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/rtk-aframe-bridge/dist/index.js"></script>
</head>
<body>
  <a-scene>
    <!-- Register the store system -->
    <a-entity id="aframe-store" aframe-store-system></a-entity>
    
    <!-- Camera -->
    <a-camera position="0 1.6 0">
      <a-cursor></a-cursor>
    </a-camera>
    
    <!-- Ground -->
    <a-plane 
      position="0 0 -4" 
      rotation="-90 0 0" 
      width="4" 
      height="4" 
      color="#7BC8A4">
    </a-plane>
    
    <!-- Reactive box that follows player position -->
    <a-box 
      id="player-box"
      position="0 0.5 -3" 
      aframe-state-component="statePath: player.position"
      material="color: #4CC3D9"
      geometry="primitive: box">
    </a-box>
    
    <!-- Score display -->
    <a-text 
      id="score-text"
      position="0 2 -3" 
      aframe-state-component="statePath: score"
      value="Score: 0"
      align="center">
    </a-text>
    
    <!-- Level display -->
    <a-text 
      id="level-text"
      position="0 1.5 -3" 
      aframe-state-component="statePath: level"
      value="Level: 1"
      align="center">
    </a-text>
    
    <!-- Interactive cube -->
    <a-box 
      id="interactive-cube"
      position="1 0.5 -3" 
      material="color: #FF6B6B"
      geometry="primitive: box"
      cursor-listener>
    </a-box>
  </a-scene>

  <script>
    // Example Redux store setup
    const { createStore } = Redux;
    
    // Simple Redux store for demo
    const initialState = {
      player: {
        position: { x: 0, y: 0.5, z: -3 },
        rotation: { x: 0, y: 0, z: 0 }
      },
      score: 0,
      level: 1
    };
    
    function gameReducer(state = initialState, action) {
      switch (action.type) {
        case 'UPDATE_PLAYER_POSITION':
          return {
            ...state,
            player: {
              ...state.player,
              position: action.payload
            }
          };
        case 'UPDATE_SCORE':
          return {
            ...state,
            score: action.payload
          };
        case 'UPDATE_LEVEL':
          return {
            ...state,
            level: action.payload
          };
        default:
          return state;
      }
    }
    
    const store = createStore(gameReducer);
    
    // Create A-Frame store and bridge
    const aframeStore = rtkAframeBridge.createAframeStore();
    const bridge = rtkAframeBridge.createBridge({
      reduxStore: store,
      aframeStore: aframeStore,
      stateSelector: (state) => state // Use entire state for demo
    });
    
    // Start the bridge
    bridge.start();
    
    // Register the store with A-Frame
    const aframeStoreSystem = document.querySelector('#aframe-store').components['aframe-store-system'];
    aframeStoreSystem.setStore(aframeStore);
    
    // Demo: Update state every 2 seconds
    let score = 0;
    setInterval(() => {
      score += 10;
      store.dispatch({ type: 'UPDATE_SCORE', payload: score });
      
      // Randomly update player position
      const x = (Math.random() - 0.5) * 2;
      const z = -3 + (Math.random() - 0.5) * 2;
      store.dispatch({ 
        type: 'UPDATE_PLAYER_POSITION', 
        payload: { x, y: 0.5, z } 
      });
    }, 2000);
    
    // Demo: Click to increase level
    document.querySelector('#interactive-cube').addEventListener('click', () => {
      const currentLevel = store.getState().level;
      store.dispatch({ type: 'UPDATE_LEVEL', payload: currentLevel + 1 });
    });
  </script>
</body>
</html>
